<div class="crear-notificacion-container">
  <!-- Navbar -->
  <nav class="navbar">
    <div class="nav-left">
      <button class="btn-back" (click)="volverAlHome()">
        ‚Üê Volver
      </button>
      <h2>Crear Nueva Notificaci√≥n</h2>
    </div>
    <div class="nav-right">
      <span class="user-name">{{ currentUser?.nombre }}</span>
      <button class="btn-logout" (click)="logout()">Cerrar Sesi√≥n</button>
    </div>
  </nav>

  <!-- Formulario -->
  <div class="form-container">
    <div class="form-card">
      <div class="card-header">
        <h3> <img src="../../../assets/notificacion.png" alt=""> Nueva Notificaci√≥n</h3>
        <p>Completa los campos para enviar una notificaci√≥n a los usuarios</p>
      </div>

      <div class="card-body">
        <!-- Tipo de notificaci√≥n -->
        <div class="form-group">
          <label class="form-label">Tipo de Notificaci√≥n: *</label>
          <div class="radio-group">
            <label class="radio-option">
              <input 
                type="radio" 
                name="tipo" 
                value="global" 
                [(ngModel)]="formulario.tipo">
              <div class="radio-content">
                <span class="radio-icon">üåç</span>
                <div class="radio-text">
                  <strong>Global</strong>
                  <small>Todos los usuarios ver√°n esta notificaci√≥n</small>
                </div>
              </div>
            </label>

            <label class="radio-option">
              <input 
                type="radio" 
                name="tipo" 
                value="personal" 
                [(ngModel)]="formulario.tipo">
              <div class="radio-content">
                <span class="radio-icon">üë§</span>
                <div class="radio-text">
                  <strong>Personal</strong>
                  <small>Solo un usuario espec√≠fico la ver√°</small>
                </div>
              </div>
            </label>
          </div>
        </div>

        <!-- Selecci√≥n de ruta -->
        <div class="form-group">
          <label class="form-label">Ruta: *</label>
          <select [(ngModel)]="formulario.rutaId" class="form-control">
            <option [ngValue]="null">Selecciona una ruta</option>
            <option *ngFor="let ruta of rutas" [ngValue]="ruta.id">
              {{ ruta.nombre }} ({{ ruta.origen }} ‚Üí {{ ruta.destino }})
            </option>
          </select>
          <small class="form-hint">
            <i class="icon"></i> Selecciona la ruta relacionada con esta notificaci√≥n
          </small>
        </div>

        <!-- C√≥digo de usuario (solo si es personal) -->
        <div class="form-group" *ngIf="formulario.tipo === 'personal'">
          <label class="form-label">C√≥digo de Usuario: *</label>
          <input 
            type="text" 
            [(ngModel)]="formulario.codigoUsuario" 
            class="form-control"
            placeholder="Ej: 7522420031"
            maxlength="20">
          <small class="form-hint">
            <i class="icon"></i> Ingresa el c√≥digo del estudiante que recibir√° la notificaci√≥n
          </small>
        </div>

        <!-- Mensaje -->
        <div class="form-group">
          <label class="form-label">Mensaje: *</label>
          <textarea 
            [(ngModel)]="formulario.mensaje" 
            class="form-control textarea"
            rows="6"
            placeholder="Escribe aqu√≠ el mensaje de la notificaci√≥n...
            
Ejemplo: El bus de la ruta Centro-Universidad saldr√° con 15 minutos de retraso debido al tr√°fico."
            maxlength="500"></textarea>
          <div class="textarea-info">
            <small class="form-hint">
              <i class="icon"></i> S√© claro y espec√≠fico en tu mensaje
            </small>
            <small class="char-count">
              {{ formulario.mensaje.length }}/500 caracteres
            </small>
          </div>
        </div>

        <!-- Vista previa -->
        <div class="preview-section" *ngIf="formulario.mensaje.trim()">
          <h4>Vista Previa:</h4>
          <div class="preview-card" 
               [class.preview-global]="formulario.tipo === 'global'"
               [class.preview-personal]="formulario.tipo === 'personal'">
            <div class="preview-badge">
              {{ formulario.tipo === 'global' ? 'üåç Global' : 'üë§ Personal' }}
            </div>
            <p class="preview-message">{{ formulario.mensaje }}</p>
            <div class="preview-route" *ngIf="formulario.rutaId">
  <strong>Ruta:</strong>
  {{ getRutaNombre(formulario.rutaId) }}
</div>
          </div>
        </div>
      </div>

      <!-- Acciones -->
      <div class="card-footer">
        <button 
          class="btn btn-secondary" 
          (click)="limpiarFormulario()"
          [disabled]="loading">
        <img src="" alt=""> Limpiar
        </button>
        <button 
          class="btn btn-primary" 
          (click)="crearNotificacion()"
          [disabled]="loading || !formulario.mensaje.trim() || !formulario.rutaId">
          <span *ngIf="!loading">‚úì Crear Notificaci√≥n</span>
          <span *ngIf="loading"> <img src="" alt="cargando"> Creando...</span>
        </button>
      </div>
    </div>
  </div>
</div>